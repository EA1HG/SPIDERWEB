class plot_base{refresh(){}constructor(t,e){var o=document.getElementById(t);this.end_point=e,this.myChart=echarts.init(o);let s=echarts.init(document.querySelector("#"+t),null);window.addEventListener("resize",function(){s.resize()})}}class band_activity extends plot_base{refresh(t){super.refresh(),console.log("refresh band_activity"),void 0!==t&&(this.selectedContinent=t),fetch(this.end_point+"?continent="+this.selectedContinent).then(t=>t.json()).then(t=>{var e=get_last_refresh(t),t=Array.from(t["band activity"]).map(function(t){return[t[1],t[0],t[2]||"-"]});this.myChart.setOption({tooltip:{position:"top",formatter:function(t){return t.seriesName+" on "+t.name+" band: <strong>"+t.data[2]+"</strong>"}},title:{text:"Band activity",subtext:e,top:"top",left:"left"},toolbox:{show:!0,showTitle:!1,orient:"vertical",right:"right",top:"bottom",feature:{mark:{show:!0},dataView:{show:!0,readOnly:!0},restore:{show:!0},saveAsImage:{show:!0}}},grid:{height:"80%",left:25,top:50,right:60,bottom:0,show:!0,backgroundColor:"rgb(255, 255, 255)"},xAxis:{type:"category",data:this.bands,axisTick:{show:!0},axisLine:{show:!1},splitArea:{show:!0}},yAxis:{type:"category",data:this.continents,axisTick:{show:!0},axisLine:{show:!1},splitArea:{show:!0}},visualMap:{calculable:!0,orient:"vertical",right:"right",top:"center",min:0,max:30,inRange:{color:["#ffffe6","yellow","red"]}},series:[{name:"Spots",type:"heatmap",data:t,label:{show:!1},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(100, 0, 0, 0.5)"}}}]})})}constructor(t,e,o,s){super(t,e);o.forEach(function(t,e){e,t.id});s.forEach(function(t,e){e,t.id});var r=getCookie("user_region"),a=getCookie("user_region_desc");r||(r="EU",a="Europe",setCookie("user_region",r,60),setCookie("user_region_desc",a,60)),selectElement("continentInput",r),addEventHandler(document.getElementById("continentInput"),"change",function(){r=this.value,a=this.options[this.selectedIndex].text,setCookie("user_region",r,60),setCookie("user_region_desc",a,60),plot_ba.refresh(r),setText("txt_continent","  Based on DX SPOTS from stations in "+a+" during the last 15 minutes, displayed by Continent and Band")}),setText("txt_continent","  Based on DX SPOTS from stations in "+a+" during the last 15 minutes, displayed by Continent and Band"),this.refresh(r)}}class world_dx_spots_live extends plot_base{refresh(){super.refresh(),console.log("refresh world_dx_spots_live"),fetch(this.end_point).then(t=>t.json()).then(s=>{fetch("world.json").then(t=>t.text()).then(t=>{var e=get_last_refresh(s),o=[];s.world_dx_spots_live.forEach(function(t,e){o.push({value:[t.lat,t.lon,t.count]})}),this.myChart.hideLoading(),echarts.registerMap("WR",t),this.myChart.setOption({visualMap:{show:!1,min:0,max:30,inRange:{symbolSize:[5,20]}},geo:{type:"map",map:"WR",roam:!0,zoom:1.2,aspectScale:1,layoutCenter:["50%","54%"],layoutSize:"100%",itemStyle:{normal:{areaColor:"#91cc75",borderColor:"#111"},emphasis:{areaColor:"#3ba272"}},label:{emphasis:{show:!1}}},tooltip:{trigger:"item",formatter:function(t){return"Spots: <STRONG>"+t.value[2]+"</STRONG>"}},toolbox:{show:!0,showTitle:!1,orient:"vertical",left:"right",top:"center",feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},restore:{show:!0},saveAsImage:{show:!0}}},legend:{show:!1},title:{text:"World DX SPOTS in last hour",subtext:e,top:"top",right:"right"},series:[{type:"scatter",coordinateSystem:"geo",data:o,label:{emphasis:{position:"right",show:!1}},itemStyle:{normal:{color:"#fc8452",borderColor:"#fa0a0a"}}}]})})})}constructor(t,e){super(t,e),this.refresh()}}class hour_band extends plot_base{refresh(){super.refresh(),console.log("refresh hour_band"),fetch(this.end_point).then(t=>t.json()).then(r=>{var t=get_last_refresh(r),e=[];for(let t=23;-1<t;t--){var o={},s=t.toString();o.name=s,e.push(o)}var a=[];this.bands.forEach(e=>{var o=[];for(let t=23;-1<t;t--)try{var s=r.hour_band[e][t];o.push(s=void 0===s?0:s)}catch(t){}a.push({value:o,name:e})}),this.myChart.setOption({legend:{orient:"horizontal",left:"left",bottom:"bottom"},title:{text:"DX SPOTS per hour in last month",subtext:t,top:"top",right:"right"},tooltip:{trigger:"axis"},toolbox:{show:!0,showTitle:!1,orient:"vertical",left:"right",top:"center",feature:{mark:{show:!0},dataView:{show:!0,readOnly:!0},restore:{show:!0},saveAsImage:{show:!0}}},radar:{shape:"circle",startAngle:105,indicator:e,center:["47%","46%"],axisName:{color:"rgb(80,80,80)"}},series:[{lineStyle:{width:2},type:"radar",symbol:"none",data:a,tooltip:{trigger:"item",formatter:t=>"Band: "+t.name},emphasis:{lineStyle:{width:4}}}]})})}constructor(t,e,o){super(t,e);let s=[];o.forEach(function(t,e){s[e]=t.id}),this.bands=s,this.refresh()}}class dx_spots_per_month extends plot_base{refresh(){console.log("refresh dx_spots_per_month"),fetch(this.end_point).then(t=>t.json()).then(e=>{var t=get_last_refresh(e),o=(new Date).getFullYear(),s=(+o).toString(),r=(o-1).toString(),o=(o-2).toString(),a=get_months_names(),n=[],i=[],h=[];for(let t=1;t<13;t++)n.push(e.spots_per_month[t].year_0),i.push(e.spots_per_month[t].year_1),h.push(e.spots_per_month[t].year_2);this.myChart.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},title:{text:"DX SPOTS per month",subtext:t,top:"top",left:"left"},legend:{data:[o,r,s],bottom:"bottom"},toolbox:{show:!0,showTitle:!1,orient:"vertical",left:"right",top:"center",feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["line","bar","stack"]},restore:{show:!0},saveAsImage:{show:!0}}},xAxis:[{type:"category",axisTick:{show:!1},data:a}],yAxis:[{type:"value",axisLabel:{formatter:function(t){return format_u_k_m(t)}}}],series:[{name:o,type:"bar",barGap:0,emphasis:{focus:"series"},data:h},{name:r,type:"bar",emphasis:{focus:"series"},data:i},{name:s,type:"bar",emphasis:{focus:"series"},data:n}]})})}constructor(t,e){super(t,e),this.refresh()}}class dx_spots_trend extends plot_base{refresh(){console.log("refresh dx_spots_trend"),fetch(this.end_point).then(t=>t.json()).then(t=>{var e,o,s=get_last_refresh(t),r=[];for([e,o]of Object.entries(t.spots_trend)){var a=[];a.push(e),a.push(o),r.push(a)}this.myChart.setOption({tooltip:{trigger:"axis",position:function(t){return[t[0],"10%"]}},title:{text:"DX SPOTS trend",subtext:s,top:"top",left:"left"},toolbox:{show:!0,showTitle:!1,orient:"vertical",left:"right",top:"center",feature:{dataView:{show:!0,readOnly:!1},dataZoom:{yAxisIndex:"none"},restore:{},magicType:{show:!0,type:["line","bar"]},saveAsImage:{}}},xAxis:{type:"time",boundaryGap:!1},yAxis:{type:"value",boundaryGap:[0,"10%"],axisLabel:{formatter:function(t){return format_u_k_m(t)}}},dataZoom:[{type:"inside",start:65,end:100},{start:0,end:20}],series:[{name:"Spots",type:"line",smooth:!0,symbol:"none",itemStyle:{color:"#078513"},areaStyle:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#57fa75"},{offset:1,color:"#118226"}])},data:r}]})})}constructor(t,e){super(t,e),this.refresh()}}var plot_ba=new band_activity("chart-band_activity","/plot_get_heatmap_data",continents_cq,band_frequencies),plot_wdsl=(setInterval(function(){plot_ba.refresh()},3e5),new world_dx_spots_live("chart-world_dx_spots_live","/plot_get_world_dx_spots_live")),plot_hb=(setInterval(function(){plot_wdsl.refresh()},3e5),new hour_band("chart-hour_band","/plot_get_hour_band",band_frequencies)),plot_dspm=(setInterval(function(){plot_hb.refresh()},36e5),new dx_spots_per_month("chart-dx_spots_x_month","/plot_get_dx_spots_per_month")),plot_dst=(setInterval(function(){plot_dspm.refresh()},432e5),new dx_spots_trend("chart-dx_spots_trend","/plot_get_dx_spots_trend"));setInterval(function(){plot_dst.refresh()},432e5);
