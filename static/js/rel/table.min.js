class table_builder{constructor(e){this.selector=e,this.current_data=[],this.first_time=!0}getLastRowId(){let e;return e=null==this.current_data||this.current_data.length<1?0:this.current_data[0].rowid}resetData(){this.current_data=[]}#buildRow(e,t,n,a=""){var r=document.createElement("tr"),t=(0<a.length||t&&!this.first_time&&(r.className="table-info"),document.createElement("i")),l=(t.className="bi-search",t.role="button",t.ariaLabel=e.de,document.createElement("a")),d=(l.href=qrz_url+e.de,l.target="_blank",l.rel="noopener",document.createElement("span")),o=(e.de==a?((o=document.createElement("mark")).textContent=e.de,d.appendChild(o)):d.textContent=" "+e.de,document.createElement("td")),t=(l.appendChild(t),o.appendChild(l),o.appendChild(d),r.append(o),Intl.NumberFormat("it-IT",{style:"decimal"}).format(e.freq)),l=document.createElement("span"),d=(l.className="badge bg-warning text-dark badge-responsive",l.textContent=t,document.createElement("td")),o=(d.appendChild(l),r.appendChild(d),findAdxo(my_adxo_events,e.dx)),t="<a href="+adxo_url+" target=_blank rel=noopener >NG3K Website</a>",l=document.createElement("i"),d=(l.className="bi-search",l.role="button",l.ariaLabel=e.dx,document.createElement("a")),c=(d.href=qrz_url+e.dx,d.target="_blank",d.rel="noopener",document.createElement("span")),s=document.createElement("mark"),s=(s.textContent=e.dx,e.dx==a?c.appendChild(s):c.textContent=" "+e.dx,null!=o&&((a=document.createElement("i")).tabIndex=0,a.className="bi-megaphone-fill",a.style="color: cornflowerblue;",a.role="button",a.ariaLabel="dx_operations",a.setAttribute("data-bs-container","body"),a.setAttribute("data-bs-toggle","popover"),a.setAttribute("data-bs-trigger","focus"),a.setAttribute("data-bs-sanitizer","true"),a.setAttribute("data-bs-placement","auto"),a.setAttribute("data-bs-html","true"),a.setAttribute("data-bs-title","Announced DX Op.: "+o.summary),a.setAttribute("data-bs-content",o.description+"data from  "+t),c.appendChild(a)),document.createElement("td"));d.appendChild(l),s.appendChild(d),s.append(c),r.appendChild(s);try{var i=document.createElement("span"),u=(i.className="img-flag fi fi-"+e.iso,i.setAttribute("data-bs-container","body"),i.setAttribute("data-bs-toggle","popover"),i.setAttribute("data-bs-trigger","hover"),i.setAttribute("data-bs-placement","left"),i.setAttribute("data-bs-content",e.country),document.createElement("td"));u.appendChild(i),r.appendChild(u)}catch(e){console.log(e),console.log("error creating flag");o=document.createElement("td");r.appendChild(o)}t=document.createElement("td"),t.className="d-none d-lg-table-cell d-xl-table-cell",t.textContent=e.country,r.appendChild(t),a=document.createElement("td");a.className="d-none d-lg-table-cell d-xl-table-cell";try{a.textContent=e.comm.substring(0,100)}catch(e){a.textContent=""}r.appendChild(a);let m=new Date(1e3*e.time),h="00"+m.getUTCHours(),p=(h=h.substring(h.length-2,h.length),"00"+m.getMinutes()),b=(p=p.substring(p.length-2,p.length),"00"+m.getUTCDate()),g=(b=b.substring(b.length-2,b.length),"00"+(Number(m.getUTCMonth())+1));g=g.substring(g.length-2,g.length);l=m.getUTCFullYear(),d=h+":"+p,m=b+"/"+g+"/"+l,c=document.createElement("div"),c.className="d-flex flex-column",s=document.createElement("div");return s.textContent=d,c.appendChild(s),m!=n&&((i=document.createElement("div")).textContent=m,c.appendChild(i)),r.appendChild(c),r}build(n,a){if(null!=n){var r=new Date;let e="00"+r.getUTCDate(),t=(e=e.substring(e.length-2,e.length),"00"+(Number(r.getUTCMonth())+1));t=t.substring(t.length-2,t.length);var r=r.getUTCFullYear(),l=e+"/"+t+"/"+r,d=(document.getElementById(this.selector).replaceChildren(),[]);for(let e=0;e<n.length;e++)document.getElementById(this.selector).append(this.#buildRow(n[e],!0,l,a)),d.push(n[e]);for(let e=0;e<this.current_data.length-n.length;e++)document.getElementById(this.selector).append(this.#buildRow(this.current_data[e],!1,l,a)),d.push(this.current_data[e]);this.current_data=d;[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')).map(function(e){return new bootstrap.Popover(e)});this.first_time=!1}}}const adxo_url="https://www.ng3k.com/misc/adxo.html",qrz_url="https://www.qrz.com/db/",tb=new table_builder("bodyspot");var qryAll_sv="";function findAdxo(t,n){if(t)for(let e=0;e<t.length;e++)if(t[e].callsign==n)return t[e]}function mySearch(e){e.preventDefault(),refresh_timer()}function getFilter(e,t,n,a){try{var r,l=[].map.call(document.getElementById(e).selectedOptions,e=>e.value);(l.length<n||-1==n)&&(r=l.map(function(e){return e?t+"="+e:""}).join("&"),"&"==(a=a.concat("&".concat(r))).substring(0,1))&&(a=a.substring(1))}catch(e){if("TypeError"!=e.name)throw e}return a}function refresh_timer(){var e=getFilter("band","b",14,"");e=getFilter("de_re","e",7,e),e=getFilter("dx_re","x",7,e),e=getFilter("mode","m",3,e),e=getFilter("cqdeInput","qe",-1,e);let t;(e=getFilter("cqdxInput","qx",-1,e))!=qryAll_sv&&(tb.resetData(),qryAll_sv=e),t="spotlist?lr=".concat(tb.getLastRowId()),t=(t=e?t.concat("&".concat(e)):t).concat("&".concat(Math.random())),fetch(t).then(e=>e.json()).then(t=>{try{tb.build(t)}catch(e){console.log(e),console.log(e.stack),console.log(t)}})}
